(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){function hxlProxyToJSON(input){var output=[];var keys=[];input.forEach(function(e,i){if(i==0){e.forEach(function(e2,i2){var parts=e2.split("+");var key=parts[0];if(parts.length>1){var atts=parts.splice(1,parts.length);atts.sort();atts.forEach(function(att){key+="+"+att})}keys.push(key)})}else{var row={};e.forEach(function(e2,i2){row[keys[i2]]=e2});output.push(row)}});return output}$(document).ready(function(){const DATA_URL="data/";let isMobile=$(window).width()<600?true:false;let communityFeedbackURL="data/Data_ DRC Ebola response community feedback - community_feedback.csv";let burdenURL="data/Data_ DRC Ebola response community feedback - ebola_burden_all.csv";let locationsURL="data/Data_ DRC Ebola response community feedback - locations.csv";let communityData,locationsData,burdenData="";let mainChart;let typesList=[],categoriesList=[],healthzonesList=[];let primeColor="#0073b7";function setKeyFigures(argument){fromDate=$("#from").datepicker("getDate");toDate=$("#to").datepicker("getDate");var selectionHZ=$(".health-zone-dropdown option:selected").text();var data=burdenData;data=data.filter(function(d){return d["health_zone"]==selectionHZ});var dataByHZ=d3.nest().key(function(d){return d["health_zone"]}).rollup(function(v){return{cases:d3.sum(v,function(d){return d["confirmed_cases"]}),deaths:d3.sum(v,function(d){return d["confirmed_deaths"]})}}).entries(data);var totalFeedback=4556;$("#cases").text(dataByHZ[0].value["cases"]);$("#deaths").text(dataByHZ[0].value["deaths"]);$("#feedbacks").text(totalFeedback)}function setFilters(argument){communityData.forEach(function(element,index){typesList.includes(element["type"])?"":typesList.push(element["type"]);categoriesList.includes(element["category"])?"":categoriesList.push(element["category"]);healthzonesList.includes(element["health_zone"])?"":healthzonesList.push(element["health_zone"])});var dropdownType=d3.select(".type-dropdown").selectAll("option").data(typesList).enter().append("option").text(function(d){return d}).attr("value",function(d){return d});var dropdwonCategory=d3.select(".category-dropdown").selectAll("option").data(categoriesList).enter().append("option").text(function(d){return d}).attr("value",function(d){return d});var dropdwonHealthZone=d3.select(".health-zone-dropdown").selectAll("option").data(healthzonesList).enter().append("option").text(function(d){return d}).attr("value",function(d){return d});var miniDate=new Date(d3.min(communityData,function(d){return d["date"]}));var maxiDate=new Date(d3.max(communityData,function(d){return d["date"]}));var dateFormat="yy-mm-dd";var from=$("#from").datepicker({dateFormat:dateFormat,minDate:miniDate,maxDate:maxiDate});var to=$("#to").datepicker({dateFormat:dateFormat,minDate:miniDate,maxDate:maxiDate});$("#from").datepicker("setDate",miniDate);$("#to").datepicker("setDate",maxiDate)}function getFilters(argument){}$("#from").datepicker().on("change",function(e){updateDashoard()});$("#to").on("changeDate",function(e){updateDashoard()});$(".type-dropdown").on("change",function(e){updateDashoard()});$(".health-zone-dropdown").on("change",function(e){updateDashoard()});$("#trendAnalysis").change(function(d){$("#trendAnalysis").is(":checked")?console.log("c est check"):console.log("c est pas check")});function updateDashoard(){setKeyFigures();var filteredData=getCommunityFeedbackData();var selectionHZ=$(".health-zone-dropdown option:selected").text();filteredData[1][0]=selectionHZ;var charts=mainChart.data.shown();var loadedCharts=[];for(k in charts){loadedCharts.push(charts[k].id)}mainChart.load({unload:loadedCharts,color:primeColor,columns:filteredData})}function drawCharts(argument){var data=getCommunityFeedbackData();var barChart,lineChart="";barChart=c3.generate({bindto:"#mainChart",padding:{left:150},size:{height:250},color:{primeColor:primeColor},data:{x:"x",columns:data,type:"bar"},axis:{rotated:true,x:{type:"category",tick:{multiline:false,centered:true,outer:false}},y:{show:false}},legend:{hide:"x"}});mainChart=barChart}var sort_value=function(d1,d2){if(d1.value>d2.value)return-1;if(d1.value<d2.value)return 1;return 0};function getCommunityFeedbackData(){fromDate=$("#from").datepicker("getDate");toDate=$("#to").datepicker("getDate");var selectionType=$(".type-dropdown option:selected").text();var selectionCategory=$(".category-dropdown option:selected").text();var selectionHZ=$(".health-zone-dropdown option:selected").text();var data=communityData;data=data.filter(function(d){var dt=new Date(d["date"]);return fromDate<=dt<=toDate});data=data.filter(function(d){return d["type"]==selectionType});data=data.filter(function(d){return d["health_zone"]==selectionHZ});var dataByMetric=d3.nest().key(function(d){return d["category"]}).rollup(function(v){return d3.sum(v,function(d){return d["n"]})}).entries(data);var total=d3.sum(dataByMetric,function(d){return d["value"]});dataByMetric.forEach(function(element,index){var pct=(element["value"]/total*100).toFixed(2);element["value"]=pct});dataByMetric.sort(sort_value);var numCategory=5;var xCategoryArr=["x"],yCategoryArr=[];yCategoryArr[0]=selectionHZ;if(dataByMetric.length>=numCategory){for(var i=0;i<numCategory;i++){xCategoryArr.push(dataByMetric[i].key);yCategoryArr.push(parseFloat(dataByMetric[i].value))}}else{for(var i=0;i<dataByMetric.length;i++){xCategoryArr.push(dataByMetric[i].key);yCategoryArr.push(parseFloat(dataByMetric[i].value))}}return[xCategoryArr,yCategoryArr]}function createMarker(d){return L.marker([d.lat,d.lon],{icon:L.divIcon({className:"circle",iconSize:null})})}function updateDashoardFromMap(event){$(".health-zone-dropdown").val(event.layer.healthZone);updateDashoard()}function generateMap(argument){var map=L.map("map",{maxZoom:10,minZoom:4});map.setView([-.361,29.053],8);L.tileLayer("https://api.mapbox.com/styles/v1/mapbox/traffic-day-v2/tiles/256/{z}/{x}/{y}?access_token=pk.eyJ1IjoiYW1hZG91MTciLCJhIjoib3NhRnROQSJ9.lW0PVXVIS-j8dGaULTyupg",{attribution:'<a href="http://mapbox.com">Mapbox</a>'}).addTo(map);var myFeatureGroup=L.featureGroup().addTo(map).on("click",updateDashoardFromMap);var marker,healthZone;var locs=[];locationsData.forEach(function(element,index){if(healthzonesList.includes(element.health_zone)){var obj={name:element.health_zone,lat:element.lat,lon:element.lng};locs.push(obj)}});locs.forEach(function(element,index){marker=createMarker(element).addTo(myFeatureGroup).bindPopup(element.name);healthZone=element.name;marker.healthZone=healthZone})}function getData(){Promise.all([d3.csv(communityFeedbackURL),d3.csv(burdenURL),d3.csv(locationsURL)]).then(function(data){communityData=data[0];burdenData=data[1];locationsData=data[2];setFilters();setKeyFigures();drawCharts();generateMap()})}function initTracking(){let MIXPANEL_TOKEN="";mixpanel.init(MIXPANEL_TOKEN);mixpanel.track("page view",{"page title":document.title,"page type":"datavis"})}getData()})},{}]},{},[1]);
